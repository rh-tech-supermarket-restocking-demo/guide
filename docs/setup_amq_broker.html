<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.15">
<title>Summary</title>
<link rel="stylesheet" href="./style.css">
</head>
<body class="article">
<div id="header">
</div>
<div id="content">
<div class="sect1">
<h2 id="_summary">Summary</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="_requirements">Requirements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Project named supermarket</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_step_1_install_the_amq_broker_operator">Step 1: Install the AMQ Broker Operator</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Find the AMQ Broker Operator in the Operator Hub. Continue by selecting it and clicking "Install".</p>
</div>
<div class="imageblock">
<div class="content">
<img src="amq-broker-operator-hub.png" alt="AMQ Broker Operator Hub">
</div>
</div>
<div class="paragraph">
<p>Set the following parameters in the Operator installation form, then click "Install".</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Update channel: 7.x</p>
</li>
<li>
<p>Installation mode: A specific namespace on the cluster</p>
</li>
<li>
<p>Installed Namespa: supermarket</p>
</li>
<li>
<p>Approval strategy: Automatic</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="amq-broker-operator-installation.png" alt="AMQ Broker Operator Installation">
</div>
</div>
<div class="paragraph">
<p>Wait for the Operator installation to complete. Open the AMQ Broker Operator management view but clicking on "View Operator" un the installation completion screen, or navigate to it via the "Installed Operators" tab in the left side-bar menu of the Administrator access.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_step_2_seup_the_supermarket_message_broker">Step 2: Seup the Supermarket Message Broker</h2>
<div class="sectionbody">
<div class="paragraph">
<p>On the AMQ Broker Operator view, select the "AMQ Broker" tab, then click "Create ActiveMQArtemis". Upon being presented with the ActiveMQArtemis configuration form, switch to the YAML view. Replace its content with the following YAML, then click "Create".</p>
</div>
<div class="listingblock">
<div class="title">Supermarket Broker YAML configuration</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: broker.amq.io/v2alpha4
kind: ActiveMQArtemis
metadata:
  namespace: supermarket
  name: supermarket-broker
  application: supermarket-broker
spec:
  acceptors:
    - enabledProtocols: amqp
      expose: true
      name: amqp
      port: 5672
      protocols: amqp
  adminPassword: toor
  adminUser: root
  deploymentPlan:
    size: 1
    persistenceEnabled: false
    requireLogin: false
    messageMigration: false
    managementRBACEnabled: false
    journalType: nio
    jolokiaAgentEnabled: false
    image: placeholder
    storage:
      size: 1Gi
  console:
    expose: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>The deployment of the broker instance can take some time. Switch to the Developer mode and navigate to the Topology view. Here you can wait for a dark blue circle to appear around the "supermarket-broker-ss" deployment.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_step_3_setup_the_broker_addresses">Step 3: Setup the Broker Addresses</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Switch back to the Administrator mode and navigate back to the AMQ Broker Operator view. Select the "AMQ Broker Address" tab, then click "Create ActiveMQArtemisAddress". Upon being presented with the ActiveMQArtemisAddress configuration form, switch to the YAML view. Replace its content with the following YAML, then click "Create".</p>
</div>
<div class="listingblock">
<div class="title">product-purchased-address YAML configuration</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: broker.amq.io/v2alpha2
kind: ActiveMQArtemisAddress
metadata:
  name: supermarket-broker-product-purchased-address
  namespace: supermarket
spec:
  addressName: productPurchasedAddress
  queueName: productPurchasedAddressQueue0
  removeFromBrokerOnDelete: true
  routingType: anycast</code></pre>
</div>
</div>
<div class="paragraph">
<p>Continue by repeating this step for the following address configuration as well.</p>
</div>
<div class="listingblock">
<div class="title">shelve-restock-required-address YAML configuration</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: broker.amq.io/v2alpha2
kind: ActiveMQArtemisAddress
metadata:
  name: supermarket-broker-shelve-restock-required-address
  namespace: supermarket
spec:
  addressName: shelveRestockRequiredAddress
  queueName: shelveRestockRequiredAddressQueue0
  removeFromBrokerOnDelete: true
  routingType: anycast</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_step_4_check_broker_setup">Step 4: Check Broker Setup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Finally, we can access the brokers management web-console to see if everything is setup as expected.</p>
</div>
<div class="paragraph">
<p>Using the Administrator mode, navigate to the Routes view and locate a route with the name "supermarket-broker-wconsj-0-svc-rte".</p>
</div>
<div class="imageblock">
<div class="content">
<img src="amq-broker-console-route.png" alt="AMQ Broker Console Route">
</div>
</div>
<div class="paragraph">
<p>Continue by clicking on the Location (URL), which will open a website where you will click the "Management Console" link. This will open the broker management web-console.</p>
</div>
<div class="paragraph">
<p>The console will ask you for login credentials. Use the username and password specified in the configuration YAML used when creating the broker (in step 2).</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Username: root</p>
</li>
<li>
<p>Password: toor</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Upon login, you will be presented with a directory tree with a root directory called "amq-broker".
Click on the second-level directory called "addresses". This will expand a list of further directories, which should include a directory for each of the addresses we configured. Clicking on any of those will show a directory "queues" containing a directory "anycast", which contains the default queue configured for this address.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="amq-broker-console-view.png" alt="AMQ Broker Console View">
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2021-07-27 14:41:48 UTC
</div>
</div>
</body>
</html>