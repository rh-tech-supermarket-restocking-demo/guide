## Setup AMQ Broker

## Summary

## Requireprents

Project named supermarket

## Setup the OpenShift AMQ Broker Operator


+++<b>Step #1 =></b>+++ 
Find the AMQ Broker Operator in the Operator Hub. Continue by selecting it and clicking "Install".

image::amq-broker-operator-hub.png[AMQ Broker Operator Hub]


+++<b>Step #2 =></b>+++ 
Set the following parameters in the Operator installation form, then click "Install".

* Update channel: 7.x
* Installation mode: A specific namespace on the cluster
* Installed Namespa: supermarket
* Approval strategy: Automatic

image::amq-broker-operator-installation.png[AMQ Broker Operator Installation]

Wait for the Operator installation to complete. Open the AMQ Broker Operator management view but clicking on "View Operator" un the installation completion screen, or navigate to it via the "Installed Operators" tab in the left side-bar menu of the Administrator access.

+++<b>Step #3 =></b>+++
On the AMQ Broker Operator view, select the "AMQ Broker" tab, then click "Create ActiveMQArtemis". Upon being presented with the ActiveMQArtemis configuration form, switch to the YAML view. Replace its content with the following YAML, then click "Create".

.Supermarket Broker YAML Configuration
[source,yaml]
----
apiVersion: broker.amq.io/v2alpha4
kind: ActiveMQArtemis
metadata:
  namespace: supermarket
  name: supermarket-broker
  application: supermarket-broker
spec:
  acceptors:
    - enabledProtocols: amqp
      expose: true
      name: amqp
      port: 5672
      protocols: amqp
  adminPassword: toor
  adminUser: root
  deploymentPlan:
    size: 1
    persistenceEnabled: false
    requireLogin: false
    messageMigration: false
    managementRBACEnabled: false
    journalType: nio
    jolokiaAgentEnabled: false
    image: placeholder
    storage:
      size: 1Gi
  console:
    expose: true
----

The deployment of the broker instance can take some time. Switch to the Developer mode and navigate to the Topology view. Here you can wait for a dark blue circle to appear around the "supermarket-broker-ss" deployment.

+++<b>Step #4 =></b>+++
Switch back to the Administrator mode and navigate back to the AMQ Broker Operator view. Select the "AMQ Broker Address" tab, then click "Create ActiveMQArtemisAddress". Upon being presented with the ActiveMQArtemisAddress configuration form, switch to the YAML view. Replace its content with the following YAML, then click "Create".

.ActiveMQArtemisAddress YAML Configuration
[source,yaml]
----
apiVersion: broker.amq.io/v2alpha2
kind: ActiveMQArtemisAddress
metadata:
  name: supermarket-broker-product-purchased-address
  namespace: supermarket
spec:
  addressName: productPurchasedAddress
  queueName: productPurchasedAddressQueue0
  removeFromBrokerOnDelete: true
  routingType: anycast
----

Continue by creating 